var tape=require("tape"),abortRequest=require("../../lib/abort-request.js"),sendRequest=require("../../lib/send-request.js");if(!("responseURL"in XMLHttpRequest.prototype)){var nativeOpen=XMLHttpRequest.prototype.open;XMLHttpRequest.prototype.open=function(e,t){return this.responseURL=t,nativeOpen.apply(this,arguments)}}tape("test aborting xhr request",function(e){var r=sendRequest.bind({options:{cacheBust:!0}});e.test("- pending request is aborted",function(e){var t=r("https://httpbin.org/delay/10",{},function(){e.fail("xhr was not aborted")});e.equal(t.readyState,1,"xhr readyState is '1' (SENT)"),abortRequest(t),e.equal(t.readyState,0,"xhr readyState is '0' (ABORTED)"),e.equal(t.status,0,"xhr HTTP status is '0' (ABORTED)"),e.equal(t.responseText,"","xhr response is empty"),e.end()}),e.test("- request is not aborted if it has already completed",function(e){var t=r("https://httpbin.org/get",{},function(){abortRequest(t),e.equal(t.readyState,4,"xhr readyState is '4' (DONE)"),e.equal(t.status,200,"xhr HTTP status is '200' (OK)"),e.end()})}),e.test("- request is not aborted if it is undefined",function(e){var t;try{abortRequest(t)}catch(t){e.fail("aborting an undefined request threw an error")}e.equal(typeof t,"undefined","undefined xhr was ignored"),e.end()}),e.end()});